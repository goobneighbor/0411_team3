<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.t09ether.home.dao.AdminDAO">
	<select id="totalRecord" resultType="int">
		select count(userid) totalRecord from registerinfo
		<if test="searchWord!=null">
			where ${searchKey} like '%${searchWord}%'
		</if> 
	</select>
	<select id="pageSelect" resultType="com.t09ether.home.dto.RegisterDTO">
	select * from
		(select * from
			(
				select rownum, a.username, a.userid, a.tel, a.email, a.rank, to_char(a.writedate,'MM-DD HH:MI') writedate, a.report 
				from (select username, userid, tel, email, rank, writedate, report from registerinfo order by username) a 
				<if test="searchWord!=null">
					where ${searchKey} like '%${searchWord}%' 
				</if>
				order by username asc 
			)
		<![CDATA[ 
	  		where rownum<=${nowPage*onePageRecord} order by username desc 
	  		]]>
	  		)
	  		
	  	<choose>
	  		<when test="nowPage!=totalPage">	
	  			<![CDATA[
	  			where rownum<=${onePageRecord} order by username asc 
	  			]]>
	  		</when>
	  		<when test="nowPage==totalPage">
	  			<![CDATA[
	  			where rownum<=${lastPageRecord} order by username asc 
	  			]]>	  		
	  		</when>
  		</choose>
	</select>
	
	<select id="rpTotalRecord" resultType="int">
		select count(report_no) totalRecord from report
		<if test="searchWord!=null">
			where ${searchKey} like '%${searchWord}%'
		</if> 
	</select>
	<select id="reportPageSelect" resultType="com.t09ether.home.dto.ReportDTO">
	select * from
		(select * from
			(
				select report_no, mem_id, target_id, report_content, to_char(writedate, 'YY-MM-DD HH:MI') writedate, target_type 
				from report
				<if test="searchWord!=null">
					where ${searchKey} like '%${searchWord}%' 
				</if>
				order by report_no desc 
			)
		<![CDATA[ 
	  		where rownum<=${nowPage*onePageRecord} order by report_no asc 
	  		]]>
	  		)
	  		
	  	<choose>
	  		<when test="nowPage!=totalPage">	
	  			<![CDATA[
	  			where rownum<=${onePageRecord} order by report_no desc 
	  			]]>
	  		</when>
	  		<when test="nowPage==totalPage">
	  			<![CDATA[
	  			where rownum<=${lastPageRecord} order by report_no desc 
	  			]]>	  		
	  		</when>
  		</choose>
  		</select>

	<select id="userSelect" resultType="com.t09ether.home.dto.RegisterDTO">
		select userid, username, tel, email, writedate, rank from registerinfo 
		<![CDATA[
		where rank>=1
		]]>	
	</select>

	<!-- 고객센터 게시물 + 페이징 -->
	<select id="csTotalRecord" resultType="int">
		select count(cus_b_num) totalRecord from cus_center
		<if test="searchWord!=null">
			where ${searchKey} like '%${searchWord}%'
		</if> 
	</select>

	<select id="csPageSelect" resultType="com.t09ether.home.dto.CustomerCenterDTO">
		select * from
			(select * from
				(select cus_b_num, category , subject, userid, to_char(writedate,'YYYY-MM-DD') writedate
					 from cus_center 
					 <if test="searchWord!=null"> <!-- 검색어가 있을 경우 -->
					 	where ${searchKey} like '%${searchWord}%'
					 </if>
					 order by cus_b_num desc
				)
			
					<![CDATA[
					where rownum<=${onePageRecord*nowPage} order by cus_b_num asc
					]]>
					) 
					<choose>
						<when test="nowPage!=totalPage">
							<![CDATA[
							where rownum<=${onePageRecord} order by cus_b_num desc
							]]>
						</when>
						<when test="nowPage==totalPage">
							<![CDATA[
							where rownum<=${lastPageRecord} order by cus_b_num desc
							]]>
						</when>
					</choose>
	</select>
		<select id="csBoardSelect" resultType="com.t09ether.home.dto.CustomerCenterDTO"> <!-- 여기서 b.userid지움 -->
		select cus_b_num, category, c.subject, c.content, r.userid, c.writedate
		from cus_center c join registerinfo r on c.userid=r.userid
		and c.cus_b_num=${param1}
	</select>
	<select id="csBoardEditSelect" resultType="com.t09ether.home.dto.CustomerCenterDTO">
		select cus_b_num, category, subject, content from cus_center where cus_b_num=${param1}
	</select>
	
	<update id="csBoardUpdate" parameterType="com.t09ether.home.dto.CustomerCenterDTO">
		update cus_center set subject=#{subject}, category=#{category}, content=#{content} where cus_b_num=${cus_b_num} and userid=#{userid}
	</update>
	<delete id="csBoardDelete">
		delete from cus_center where cus_b_num=${cus_b_num} and userid=#{userid}
	</delete>
	
</mapper>